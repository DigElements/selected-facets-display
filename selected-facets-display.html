<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../bread-box/bread-box.html">
<link rel="import" href="../dig-common/dig-common.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-styles/color.html">

<!--
Polymer element providing a way to view and remove selected facets in a breadbox. Can be used with elastic-checkbox-list-filter and checkbox-list-display.

Example:

    <selected-facets-display facet-selection="{{countryFacetSelection}}">
    </selected-facets-display>

### Styling

`<selected-facets-display>` provides the following custom properties and mixins
for styling:

Custom property | Description | Default
----------------|-------------|----------
`--selected-facet-bg-color` | Background color of a facet tag | --paper-blue-grey-200
`--selected-facet-text-color` | Text color for facets | --paper-blue-grey-800
`--selected-facet-icon-hover-color` | Color for close icon on hover | --paper-blue-800

@demo demo/index.html
-->

<dom-module id="selected-facets-display">
  <template>
    <style>
      bread-box {
        --bread-box-bg-color: var(--selected-facet-bg-color);
        --bread-box-text-color: var(--selected-facet-text-color);
      }
      bread-box ::content iron-icon {
        --iron-icon-height: 18px;
        --iron-icon-width: 18px;
        vertical-align: middle;
      }
      bread-box ::content iron-icon:hover {
        color: var(--selected-facet-icon-hover-color, --paper-blue-800);
        cursor: pointer;
      }
    </style>
    <template is="dom-repeat" items="{{getFacetSelectionKeys(facetSelection.*)}}" as="facetKey">
      <bread-box
        text="[[getFacetProperty(facetKey, 'category')]]: [[getFacetProperty(facetKey, 'text', facetSelection.*)]]"
        title$="[[getFacetProperty(facetKey, 'category')]]: [[getFacetProperty(facetKey, 'text', facetSelection.*)]]">

        <iron-icon title="Remove Facet" on-tap="disableFacet" icon="close"></iron-icon>
      </bread-box>
    </template>
  </template>
  <script>
    Polymer({
      is: 'selected-facets-display',

      properties: {
        /**
         * Contains state of facet checkboxes
         *
         * @type: {{'Los Angeles': {text: 'Los Angeles, CA', key: 'Los Angeles', count: 10, enabled: true, category: 'City'}}}
         */
        facetSelection: {
          type: Object,
          value: function() {
            return {};
          },
          notify: true
        }
      },
      /**
       * Obtains sub property of key specified in facetSelection.
       *
       * @param {String} key of facet in facetSelection
       * @param {String} prop - subproperty of key
       * @return {String}
       */
      getFacetProperty: function(key, prop) {
        return this.facetSelection[key][prop];
      },
      /**
       * Get all keys for facetSelection object
       *
       * @return {Array} keys
       */
      getFacetSelectionKeys: function() {
        var me = this;
        var keys = _.keys(this.facetSelection);
        var filtered = _.filter(keys, function(key) {
          return me.facetSelection[key].enabled === true;
        });
        return filtered;
      },
      /**
       * When user taps close icon, the current facet is removed from the enabled filters.
       *
       * @event tap
       */
      disableFacet: function(event) {
        var facetKey = event.model.facetKey;
        this.facetSelection[facetKey].enabled = false;
        this.notifyPath('facetSelection.*', this.facetSelection[facetKey]);
      }
    });
  </script>
</dom-module>
